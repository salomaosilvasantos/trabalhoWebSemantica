@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix tcu: <http://arida.ufc.br/vocab/resource/tcu/> .
@prefix map: <#> .
@prefix rr: <http://www.w3.org/ns/r2rml#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix conf: <http://ufc.arida.br/conf/> .
@prefix vcard: <http://www.w3.org/TR/vcard-rdf/> .
@prefix dc: <http://dublincore.org/documents/dc-rdf/> .
@prefix dcterms: <http://dublincore.org/documents/dcmi-terms/> .
@prefix dbo: <http://dbpedia.org/ontology/>.
@prefix dbr: <http://dbpedia.org/resource/>.
@prefix time: <http://www.w3.org/TR/owl-time/>.


#Mapeamento com view pessoa_tcu_view
 map:Person a rr:TriplesMap;
    rr:logicalTable [ 
            rr:sqlQuery """SELECT * from pessoa_tcu_view""" ];
    rr:subjectMap [
        rr:template "http://arida.ufc.br/tcu/restringidopessoa/{ID}";
        rr:class foaf:Person;
    ];
    rr:predicateObjectMap [
        rr:predicate foaf:name;
        rr:objectMap [            
            rr:template "{Nome}"; 
            rr:termType rr:Literal;
        ];
    ]; 
    rr:predicateObjectMap [
        rr:predicate dbr:cpf;
        rr:objectMap [            
            rr:template "{CPF}"; 
            rr:termType rr:Literal;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate rdf:id;
        rr:objectMap [            
            rr:template "{id}"; 
            rr:termType rr:Literal;
        ];
    ]; .

#Mapeamento com view restricao_tcu_view
  map:Restricao a rr:TriplesMap;
    rr:logicalTable [ 
            rr:sqlQuery """SELECT * from restricao_tcu_view""" ];
    rr:subjectMap [
        rr:template "http://arida.ufc.br/tcu/restricao/{rid}";
        rr:class tcu:Restricao;
    ];
    rr:predicateObjectMap [
        rr:predicate rdf:id;
        rr:objectMap [            
            rr:template "{rid}"; 
            rr:termType rr:Literal;
        ];
    ];
    rr:predicateObjectMap [
	rr:predicate tcu:numeroProcesso;
	rr:objectMap [            
	    rr:template "{numProcess}"; 
	    rr:termType rr:Literal;
	];
    ];
    rr:predicateObjectMap [
	rr:predicate time:endDate;
	rr:objectMap [            
	    rr:template "{data_final}"; 
	    rr:termType rr:Literal;
	];
    ];
    rr:predicateObjectMap [
	rr:predicate foaf:state;
	rr:objectMap [            
	    rr:template "{uf}"; 
	    rr:termType rr:Literal;
	];
    ];
    rr:predicateObjectMap [
	rr:predicate tcu:numeroDeliberacao;
	rr:objectMap [            
	    rr:template "{numdeliberacao}"; 
	    rr:termType rr:Literal;
	];
    ];
.


#relacao entre as tabela pessoa e restricao
   map:Person_tem_restricao
	rr:logicalTable [ rr:sqlQuery """
                SELECT p.id as id_pessoa, r.rid as id_restricao 
		FROM pessoa_tcu_view p, restricao_tcu_view r
		WHERE p.id= r.pessoa_id
	""" ];

	rr:subjectMap [
		rr:template 'http://arida.ufc.br/tcu/restringidopessoa/{"id_pessoa"}';
		#rr:class foaf:Person; 
	];

	rr:predicateObjectMap [ 
		rr:predicate tcu:temRestricao; 
		rr:objectMap [
			rr:parentTriplesMap map:Restricao;
			rr:joinCondition[
				rr:child 'id_restricao';
				rr:parent 'rid';
			] 
		]
	].

#Mapeamento table Provenance
  map:Provenance a rr:TriplesMap;
    rr:logicalTable [ 
            rr:sqlQuery """SELECT * from provenance""" ];
    rr:subjectMap [
        rr:template "http://arida.ufc.br/tcu/provenance/{id}";
        rr:class tcu:Provenance;
    ];
    rr:predicateObjectMap [
        rr:predicate rdf:id;
        rr:objectMap [            
            rr:template "{id}"; 
            rr:termType rr:Literal;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate rdfs:label;
        rr:objectMap [            
            rr:template "{label}"; 
            rr:termType rr:Literal;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate dbr:fileName;
        rr:objectMap [            
            rr:template "{filename}"; 
            rr:termType rr:Literal;
        ];
    ]; 
    rr:predicateObjectMap [
        rr:predicate time:date;
        rr:objectMap [            
            rr:template "{date}"; 
            rr:termType rr:Literal;
        ];
    ]; 
    rr:predicateObjectMap [
        rr:predicate dc:source;
        rr:objectMap [            
            rr:template "{source}"; 
            rr:termType rr:Literal;
        ];
    ]; 
    rr:predicateObjectMap [
        rr:predicate tcu:complement;
        rr:objectMap [            
            rr:template "{complement}"; 
            rr:termType rr:Literal;
        ];
    ]; .

#relacao entre as tabela restricao e provenance
   map:Restritor_tem_provenance
	rr:logicalTable [ rr:sqlQuery """
                SELECT r.rid as id_restricao, p.id as id_provenance
		FROM restricao_tcu_view r, provenance p
		WHERE r.provenance_id= p.id
	""" ];

	rr:subjectMap [
		rr:template 'http://arida.ufc.br/tcu/restricao/{"id_restricao"}';
		#rr:class tcu:Restricao; 
	];

	rr:predicateObjectMap [ 
		rr:predicate tcu:temProvenance; 
		rr:objectMap [
			rr:parentTriplesMap map:Provenance;
			rr:joinCondition[
				rr:child 'id_provenance';
				rr:parent 'id';
			] 
		]
	].

#Mapeamento table Restritor
  map:Restritor a rr:TriplesMap;
    rr:logicalTable [ 
            rr:sqlQuery """SELECT * from restritor""" ];
    rr:subjectMap [
        rr:template "http://arida.ufc.br/tcu/restritor/{id}";
        rr:class tcu:Restritor;
    ];
    rr:predicateObjectMap [
        rr:predicate rdf:id;
        rr:objectMap [            
            rr:template "{id}"; 
            rr:termType rr:Literal;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate rdfs:label;
        rr:objectMap [            
            rr:template "{label}"; 
            rr:termType rr:Literal;
        ];
    ];
 .

#relacao entre as tabela restricao e restritor
   map:restricao_tem_restritor
	rr:logicalTable [ rr:sqlQuery """
                SELECT res.rid as restricao_id, r.id as restritor_id
		FROM restricao_tcu_view res, restritor r
		WHERE res.restritor_id=r.id
	""" ];
	rr:subjectMap [
		rr:template 'http://arida.ufc.br/tcu/restricao/{"restricao_id"}';
		#rr:class tcu:Restricao; 
	];

	rr:predicateObjectMap [ 
		rr:predicate tcu:temRestritor; 
		rr:objectMap [
			rr:parentTriplesMap map:Restritor;
			rr:joinCondition[
				rr:child 'restricao_id';
				rr:parent 'id';
			] 
		]
	].

